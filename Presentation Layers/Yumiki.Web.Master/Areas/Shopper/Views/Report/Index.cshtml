@using Yumiki.Web.Shopper.Constants
@using Yumiki.Commons.Dictionaries;
@using Yumiki.Commons.Entities;
@using Yumiki.Entity.Shopper.ServiceObjects;
@using SquishIt.Framework;
@using Yumiki.Entity.Shopper;
@using Yumiki.Commons.Report;

@{
    ViewBag.Title = "Report";
}

@section BottomScript{
    @MvcHtmlString.Create(
        Bundle.JavaScript()
        .Add("~/Areas/Shopper/clients/scripts/yumiki-shopper.js")
        .Add("~/Areas/Shopper/clients/scripts/yumiki-shopper-revenue-report.js")
        .WithMinifier(new SquishIt.Framework.Minifiers.JavaScript.JsMinMinifier())
        .Render("~/cache/yumiki_#.js"))

    <script type="text/javascript">
        yumiki.shopper.init (
            '@Yumiki.Commons.Logging.LogLevel.ERROR'
        );

        yumiki.shopper.report.initReport(
            'cvReportChart',
            {
                '@GetReportRequest.FieldName.ReportType': @((int)EN_ReportType.E_YEAR),
                '@GetReportRequest.FieldName.StartDate': '@ViewBag.CurrentDate',
                '@GetReportRequest.FieldName.EndDate': '@ViewBag.CurrentDate',
                '@GetReportRequest.FieldName.SplitIncomeOutcomeView': true,
                '@GetReportRequest.FieldName.CalculateTotal': false
            },
            {
                reportGetReportTypesUrl: '@Url.HttpRouteUrl(RouteNames.ReportGetReportRevenueTypes, null)',
                reportGenerateReportUrl: '@Url.HttpRouteUrl(RouteNames.ReportGenerateRevenueReport, null)'
            },
            {
                month: @((int)EN_ReportType.E_MONTH),
                period: @((int)EN_ReportType.E_PERIOD),
                year: @((int)EN_ReportType.E_YEAR)
            },
            '@ViewBag.CurrentDate',
            '@Yumiki.Commons.Dictionaries.Formats.DateTime.ClientMomentLongDate'
        )
    </script>
}

<div ng-app="report">
    <div class="container" ng-controller="reportController" ng-init="loadData();">
        <h1>Revenue Report</h1>
        <form name="reportForm" ng-submit="getReport(reportForm.$valid)" novalidate>
            <div class="card bg-secondary">
                <div class="card-body p-2">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" ng-disabled="reportForm.$invalid">Report</button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select class="form-control selectpicker"
                                ng-class="{ 'border-danger' : reportForm.reportType.$invalid && reportForm.reportType.$dirty }"
                                name="reportType" ng-required="true"
                                ng-model="requestObject.@GetReportRequest.FieldName.ReportType"
                                ng-options="item.@ExtendEnum.FieldName.Value as item.@ExtendEnum.FieldName.DisplayText for item in reportTypes"
                                ng-change="updateReportType()"></select>
                        <p ng-show="reportForm.reportType.$error.required && reportForm.reportType.$dirty" class="text-danger">Report Type is required.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-check mt-2">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" ng-model="requestObject.@GetReportRequest.FieldName.CalculateTotal" ng-checked="requestObject.@GetReportRequest.FieldName.CalculateTotal" /> <b>Calculate Only Total Amount</b>
                        </label>
                    </div>
                    <div class="form-check mt-3 mb-2">
                        <label class="form-check-label">
                            <input type="checkbox" class="form-check-input" ng-model="requestObject.@GetReportRequest.FieldName.SplitIncomeOutcomeView" ng-checked="requestObject.@GetReportRequest.FieldName.SplitIncomeOutcomeView" /> <b>Split Income/Outcome View</b>
                        </label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label>{{startDateLabel}}</label>
                        <div class='input-group date' datetimepicker datetimeformat="'@Formats.DateTime.ClientMomentLongDate'" ng-model="requestObject.@GetReportRequest.FieldName.StartDate" ng-change="updateDates(0)">
                            <input type="text" name="startDate" ng-model="requestObject.@GetReportRequest.FieldName.StartDate" class="form-control" />
                            <div class="input-group-append input-group-calendar">
                                <span class="input-group-text">
                                    <span class="fa fa-calendar"></span>
                                </span>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group" ng-show="isEndDateVisible">
                        <label>End Date</label>
                        <div class='input-group date' datetimepicker datetimeformat="'@Formats.DateTime.ClientMomentLongDate'" ng-model="requestObject.@GetReportRequest.FieldName.EndDate" ng-change="updateDates(1)">
                            <input type="text" name="endDate" ng-model="requestObject.@GetReportRequest.FieldName.EndDate" class="form-control" />
                            <div class="input-group-append input-group-calendar">
                                <span class="input-group-text">
                                    <span class="fa fa-calendar"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <hr />
        <div class="row" ng-show="showReport">
            <div class="col-md">
                <canvas id="cvReportChart"></canvas>
            </div>
        </div>
    </div>
</div>
